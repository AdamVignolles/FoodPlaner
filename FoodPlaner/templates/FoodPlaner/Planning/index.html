{% load static %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Planning Page</title>
    <link rel="icon" href="{% static 'img/logo.png' %}" type="image/icon type">
    <link href="https://fonts.googleapis.com/css2?family=Jost:wght@500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/Planning/style.css' %}">
</head>
<body>
    <header>
        <nav role="navigation">
            <div id="menuToggle">
                <input type="checkbox" />

                <span></span>
                <span></span>
                <span></span>
                
                <ul id="menu">
                    <a href="#planning"><li>Planning</li></a>
                    <a href="#recette"><li>Recette</li></a>
                    <a href="#liste-de-course"><li>Liste de Course</li></a>
                    <a href="/user/"><li>Profile</li></a>
                    <a href="/user/#logout"><li>Logout</li></a>
                </ul>
            </div>
        </nav>
        <a href="/">
            <h1>FoodPlaner</h1>
        </a>
        {{base_image}}
        <a href="/user" class="user_image">
            <img src="{{base_image}}" with="64px" height="64px" alt="{{base_image}}">
        </a>
    </header>

    <div class="content">
        <div id="planning" class="show card">
            <h1>Planning</h1>
        </div>
        <div id="recette" class="hide card">
            <div class="nav_recette hide">
                <nav class="menu_recette">
                    <ul>
                        <a href="#favorite">Mes Favoris</a>
                        <a href="#creation">Mes Creation</a>
                        <a href="#rechercher_recette">Rechercher</a>
                    </ul>
                </nav>
            </div>
            <div class="part_recette hide">
                <div id="favorite" class="hide">
                    <h3>Mes Favorites</h3>
                    {% for id, recette in recettes_favorites.items %}
                        <div class="recette_card {{id}}">
                            <div class="content_recette_card">
                                <img src="{{recette.img}}" width="64px">
                                <h4>{{ recette.nom }}</h4>
                                <p>{{recette.author}}</p>

                                <!-- sup the fav when img liked is click-->

                                <form  method="POST">
                                    {% csrf_token %}
                                    <button id="fav" type="submit" name="supfav" value="{{id}}">
                                        <img src="{% static 'img/liked.png' %}" width="32px" height="32px">
                                    </button>
                                </form>


                                <img class="fleche" src="{% static 'img/fleche.png' %}" width="32px" height="32px">
                            </div>
                            <div class="info_recette hide">
                                <div class="derouler">
                                    <p>Derouler:</p>
                                    <ul>
                                        {% for derouler in recette.derouler %}
                                            <li>{{derouler}}</li>
                                        {% endfor %}
                                    </ul>
                                    
                                </div>
                                <div class="ingredients">
                                    <p>Ingredients:</p>
                                    <!--Select number of person without limit-->
                                    <input type="number" pattern="[0-9]*" inputmode="numeric" placeholder="n° person">
                                    <ul>
                                        {% for ingredient in recette.ingredients %}
                                            <li>{{ingredient}}</li>
                                        {% endfor %}
                                    </ul>
                                    
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
                <div id="creation" class="hide">
                    <h3>Mes Creation</h3>
                    {% for id, recette in recettes_creation.items %}
                        <div class="recette_card {{id}}">
                            <div class="content_recette_card">
                                <img src="{{recette.img}}" width="64px">
                                <h4>{{ recette.nom }}</h4>
                                <p>{{recette.author}}</p>

                                <!-- affiche image liked if recette.liked = TRue-->
                                {% if recette.liked == True %}
                                    <form  method="POST">
                                        {% csrf_token %}
                                        <button id="fav" type="submit" name="supfav" value="{{id}}">
                                            <img src="{% static 'img/liked.png' %}" width="32px" height="32px">
                                        </button>
                                    </form>
                                {% else %}
                                    <form  method="POST">
                                        {% csrf_token %}
                                        <button id="fav" type="submit" name="addfav" value="{{id}}">
                                            <img src="{% static 'img/like.png' %}" width="32px" height="32px">
                                        </button>
                                    </form>
                                {% endif %}
                                
                                <img class="fleche" src="{% static 'img/fleche.png' %}" width="32px" height="32px">
                            </div>
                            <div class="info_recette hide">
                                <div class="derouler">
                                    <p>Derouler:</p>
                                    <ul>
                                        {% for derouler in recette.derouler %}
                                            <li>{{derouler}}</li>
                                        {% endfor %}
                                    </ul>
                                    
                                </div>
                                <div class="ingredients">
                                    <p>Ingredients:</p>
                                    <!--Select number of person without limit-->
                                    <input type="number" pattern="[0-9]*" inputmode="numeric" placeholder="n° person">
                                    <ul>
                                        {% for ingredient in recette.ingredients %}
                                            <li>{{ingredient}}</li>
                                        {% endfor %}
                                    </ul>
                                    
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
                <div id="rechercher_recette" class="hide">
                    <h3>Rechercher une Recette</h3>
                    <form method="POST">
                        {% csrf_token %}
                        <input type="text" name="search" placeholder="Rechercher une recette">
                        <button type="submit">Rechercher</button>
                    </form>

                    {% for id, recette in recette_recherche.items %}
                        <div class="recette_card {{id}}">
                            <div class="content_recette_card">
                                <img src="{{recette.img}}" width="64px">
                                <h4>{{ recette.nom }}</h4>
                                <p>{{recette.author}}</p>

                                <!-- affiche image liked if recette.liked = TRue-->
                                {% if recette.liked == True %}
                                    <form  method="POST">
                                        {% csrf_token %}
                                        <button id="fav" type="submit" name="supfav" value="{{id}}">
                                            <img src="{% static 'img/liked.png' %}" width="32px" height="32px">
                                        </button>
                                    </form>
                                {% else %}
                                    <form  method="POST">
                                        {% csrf_token %}
                                        <button id="fav" type="submit" name="addfav" value="{{id}}">
                                            <img src="{% static 'img/like.png' %}" width="32px" height="32px">
                                        </button>
                                    </form>
                                {% endif %}
                                
                                <img class="fleche" src="{% static 'img/fleche.png' %}" width="32px" height="32px">
                            </div>
                            <div class="info_recette hide">
                                <div class="derouler">
                                    <p>Derouler:</p>
                                    <ul>
                                        {% for derouler in recette.derouler %}
                                            <li>{{derouler}}</li>
                                        {% endfor %}
                                    </ul>
                                    
                                </div>
                                <div class="ingredients">
                                    <p>Ingredients:</p>
                                    <!--Select number of person without limit-->
                                    <input type="number" pattern="[0-9]*" inputmode="numeric" placeholder="n° person">
                                    <ul>
                                        {% for ingredient in recette.ingredients %}
                                            <li>{{ingredient}}</li>
                                        {% endfor %}
                                    </ul>
                                    
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        <div id="liste-de-course" class="hide card">
            <h1>Liste de course</h1>
        </div>
    </div>

    <script>

        function DoSubmit(){
            let username = localStorage.getItem("username");

            document.page_user.user_page.value = username;

        }
        const card = document.querySelectorAll('.card');
        const links = document.querySelectorAll('#menu a');
        const planning = document.getElementById('planning');
        const recette = document.getElementById('recette');
        const liste_de_course = document.getElementById('liste-de-course');
        let nav_recette = document.querySelector('.nav_recette');
        let part_recette = document.querySelector('.part_recette');
        let favorite = document.getElementById('favorite');
        let creation = document.getElementById('creation');
        let rechercher_recette = document.getElementById('rechercher_recette');
        let info_recette = document.querySelector('.info_recette');


        function hideAll() {
            for (let i = 0; i < card.length; i++) {
                card[i].classList.remove('show');
                card[i].classList.add('hide');
            }
            planning.classList.remove('show');
            planning.classList.add('hide');
            recette.classList.remove('show');
            recette.classList.add('hide');
            liste_de_course.classList.remove('show');
            liste_de_course.classList.add('hide');
            nav_recette.classList.remove('show');
            nav_recette.classList.add('hide');
            favorite.classList.remove('show');
            favorite.classList.add('hide');
            part_recette.classList.remove('show');
            part_recette.classList.add('hide');
            info_recette.classList.remove('show');
            info_recette.classList.add('hide');
            creation.classList.remove('show');
            creation.classList.add('hide');
            rechercher_recette.classList.remove('show');
            rechercher_recette.classList.add('hide');
        }

        for (let i = 0; i < links.length; i++) {
            links[i].addEventListener('click', function() {
                for (let j = 0; j < card.length; j++) {
                    hideAll();
                    card[j].classList.remove('show');
                    card[j].classList.add('hide');
                }
                if (links[i].hash == "#planning") {
                    hideAll();
                    planning.classList.remove('hide');
                    planning.classList.add('show');
                } else if (links[i].hash == "#recette") {
                    hideAll();
                    recette.classList.remove('hide');
                    recette.classList.add('show');
                    nav_recette.classList.remove('hide');
                    nav_recette.classList.add('show');
                    favorite.classList.remove('hide');
                    favorite.classList.add('show');
                    part_recette.classList.remove('hide');
                    part_recette.classList.add('show');
                } else if (links[i].hash == "#liste-de-course") {
                    hideAll();
                    liste_de_course.classList.remove('hide');
                    liste_de_course.classList.add('show');
                }
            });
        }

        let recettes_links = document.querySelectorAll('nav.menu_recette ul a');
        for (let i = 0; i < recettes_links.length; i++) {
            recettes_links[i].addEventListener('click', function() {
                console.log(recettes_links[i].hash);
                
                if (recettes_links[i].hash == "#favorite") {
                    hideAll();
                    console.log(favorite.classList);
                    favorite.classList.remove('hide');
                    favorite.classList.add('show');
                    part_recette.classList.remove('hide');
                    part_recette.classList.add('show');
                    nav_recette.classList.remove('hide');
                    nav_recette.classList.add('show');
                } else if (recettes_links[i].hash == "#creation") {
                    hideAll();
                    console.log(creation.classList);
                    creation.classList.remove('hide');
                    creation.classList.add('show');
                    part_recette.classList.remove('hide');
                    part_recette.classList.add('show');
                    nav_recette.classList.remove('hide');
                    nav_recette.classList.add('show');
                } else if (recettes_links[i].hash == "#rechercher_recette") {
                    hideAll();
                    console.log(rechercher_recette.classList);
                    rechercher_recette.classList.remove('hide');
                    rechercher_recette.classList.add('show');
                    part_recette.classList.remove('hide');
                    part_recette.classList.add('show');
                    nav_recette.classList.remove('hide');
                    nav_recette.classList.add('show');
                }
            });
        }

        let fleches = document.querySelectorAll('.fleche');
        for (let i = 0; i < fleches.length; i++) {
            fleches[i].addEventListener('click', function() {
                /*get the div fleche who was click and active is info_recette*/
                let info_recette = fleches[i].parentElement.parentElement.querySelector('.info_recette');

                if (info_recette.classList.contains('hide')) {
                    info_recette.classList.remove('hide');
                    info_recette.classList.add('show');
                    fleches[i].style.transform = "rotate(270deg)";
                } else {
                    info_recette.classList.remove('show');
                    info_recette.classList.add('hide');
                    fleches[i].style.transform = "rotate(180deg)";
                }
            });
        }
    
        
    </script>
</body>
</html>